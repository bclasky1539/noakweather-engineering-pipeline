# AWS IAM User Setup for DynamoDB Access

Complete guide for creating an IAM user with DynamoDB permissions for the weather-platform project.

---

## Prerequisites

- Active AWS account
- Access to AWS Console with administrator privileges
- Basic understanding of IAM concepts

---

## Step 1: Log into AWS Console

1. Navigate to https://console.aws.amazon.com
2. Sign in with your AWS account credentials

---

## Step 2: Navigate to IAM

1. In the AWS Console search bar (top), type **"IAM"**
2. Click **"IAM"** (Identity and Access Management)
3. You should see the IAM Dashboard

---

## Step 3: Create a New IAM User

1. In the left sidebar, click **"Users"**
2. Click the **"Create user"** button (orange button, top right)

### User Configuration

**User name:** `noakweather-platform-dev` (or your preferred name)

**Console access options:**
- **Select:** `"Provide user access to the AWS Management Console"`

When prompted "Are you providing console access to a person?":

- **Select:** `"I want to create an IAM user"`
    - This is for programmatic access (AWS SDK)
    - Simpler setup for individual developers
    - Direct access keys generation

**Console Password Settings:**

- **Select:** `"Autogenerated password"`
    - AWS generates a secure random password
    - Displayed after user creation

- **Keep checked:** `"Users must create a new password at next sign-in - Recommended"`
    - Forces password change on first login
    - Good security practice

3. Click **"Next"**

---

## Step 4: Set Permissions

### Option A: Add to Existing "Developers" Group Recommended

If you already have a "Developers" group with appropriate permissions:

1. **Select:** `"Add user to group"`
2. **Check the checkbox** next to **"Developers"** group
3. Verify the group has `AmazonDynamoDBFullAccess` policy attached
4. Click **"Next"**

**Benefits:**
- Centralized permission management
- Easy to add/remove users
- Group may already have other useful permissions (S3, Lambda, etc.)

### Option B: Attach Policies Directly (Alternative)

If you don't have an appropriate group:

1. **Select:** `"Attach policies directly"`
2. Search for and select: **`AmazonDynamoDBFullAccess`**
3. This allows all DynamoDB operations
4. Click **"Next"**

### Option C: Create Custom Policy (Most Secure)

For production or restricted environments:

1. Click **"Create policy"**
2. Select **JSON** tab
3. Paste the following policy:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:PutItem",
        "dynamodb:GetItem",
        "dynamodb:UpdateItem",
        "dynamodb:DeleteItem",
        "dynamodb:Query",
        "dynamodb:Scan",
        "dynamodb:BatchWriteItem",
        "dynamodb:BatchGetItem",
        "dynamodb:DescribeTable",
        "dynamodb:CreateTable",
        "dynamodb:DeleteTable",
        "dynamodb:UpdateTable",
        "dynamodb:ListTables"
      ],
      "Resource": [
        "arn:aws:dynamodb:*:*:table/weather-*"
      ]
    }
  ]
}
```

4. **Policy name:** `WeatherPlatformDynamoDBAccess`
5. **Description:** "DynamoDB access for weather-platform tables"
6. Click **"Create policy"**
7. Return to user creation and attach the new policy

**This custom policy:**
- Limits access to tables starting with `weather-*`
- Includes only necessary DynamoDB operations
- More secure than full access

---

## Step 5: Review and Create

1. Review all user details:
    - User name
    - Console access settings
    - Permissions (group or policies)
2. Click **"Create user"**

---

## Step 6: Create Access Keys for Programmatic Access

After user creation, you need access keys for the AWS SDK:

1. In the user list, click on your new user: **`weather-platform-dev`**
2. Click the **"Security credentials"** tab
3. Scroll down to **"Access keys"** section
4. Click **"Create access key"**

### Access Key Configuration

**Select use case:**
- Choose **"Command Line Interface (CLI)"**
- Check the confirmation checkbox at the bottom
- Click **"Next"**

**Optional description tag:**
- **Description:** `Local development - weather-storage module`
- Click **"Create access key"**

---

## Step 7: Download and Save Credentials CRITICAL

You'll see a screen displaying:
- **Access key ID:** `AKIAIOSFODNN7EXAMPLE`
- **Secret access key:** `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`

### IMPORTANT SECURITY NOTES

- This is the **ONLY TIME** you can view the secret access key
- **NEVER** commit these credentials to Git
- Store them securely

### Save Options

**Option 1: Download CSV File** Recommended
1. Click **"Download .csv file"**
2. Save to a secure location
3. **DO NOT** store in your project directory
4. Suggested location: `~/Documents/aws-credentials/`

**Option 2: Copy Manually**
1. Copy both the Access Key ID and Secret Access Key
2. Store in a password manager or secure note

---

## Step 8: Configure AWS Credentials Locally

### Using AWS Credentials File (Recommended)

1. Create AWS credentials directory:
```bash
mkdir -p ~/.aws
```

2. Create credentials file:
```bash
touch ~/.aws/credentials
```

3. Set secure permissions:
```bash
chmod 600 ~/.aws/credentials
```

4. Edit the file and add your credentials:
```bash
nano ~/.aws/credentials
```

5. Add the following content:
```ini
[default]
aws_access_key_id = YOUR_ACCESS_KEY_ID
aws_secret_access_key = YOUR_SECRET_ACCESS_KEY
region = us-east-1
```

**Region Options:**
- `us-east-1` (N. Virginia) - Most services, typically cheapest
- `us-west-2` (Oregon) - Good for West Coast
- `eu-west-1` (Ireland) - For Europe
- `ap-southeast-1` (Singapore) - For Asia

6. Save and close (Ctrl+X, then Y, then Enter)

### Alternative: Environment Variables

If you prefer not to use a credentials file:

```bash
export AWS_ACCESS_KEY_ID="YOUR_ACCESS_KEY_ID"
export AWS_SECRET_ACCESS_KEY="YOUR_SECRET_ACCESS_KEY"
export AWS_DEFAULT_REGION="us-east-1"
```

Add these to your `~/.bashrc` or `~/.zshrc` for persistence.

---

## Step 9: Verify Credentials Setup

Test your credentials using AWS CLI:

```bash
# Install AWS CLI if not already installed
# macOS: brew install awscli
# Linux: sudo apt-get install awscli
# Windows: download from AWS website

# List DynamoDB tables (should return empty list or existing tables)
aws dynamodb list-tables --region us-east-1
```

**Expected output:**
```json
{
    "TableNames": []
}
```

### Java Verification Test

Create a test file to verify SDK can access AWS:

```java
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.dynamodb.DynamoDbClient;
import software.amazon.awssdk.services.dynamodb.model.ListTablesResponse;

public class AwsCredentialsTest {
    public static void main(String[] args) {
        try {
            // Creates client using default credentials provider chain
            DynamoDbClient dynamoDB = DynamoDbClient.builder()
                .region(Region.US_EAST_1)
                .build();
            
            System.out.println("Successfully connected to AWS!");
            
            ListTablesResponse response = dynamoDB.listTables();
            System.out.println("Existing tables: " + response.tableNames());
            
        } catch (Exception e) {
            System.err.println("Credentials not configured properly:");
            e.printStackTrace();
        }
    }
}
```

---

## Step 10: Security Best Practices

### Update .gitignore

Ensure credentials are **NEVER** committed to Git:

Add to your `.gitignore`:

```gitignore
# AWS credentials - NEVER COMMIT THESE
.aws/
*.pem
*.key
aws-credentials.properties
aws-credentials.csv
credentials.csv

# Environment files
.env
.env.local
.env.*.local

# AWS CLI config
.aws/credentials
.aws/config
```

### Additional Security Measures

1. **Rotate Access Keys Regularly**
    - Change access keys every 90 days
    - Use AWS IAM console to create new keys
    - Delete old keys after rotation

2. **Enable MFA (Multi-Factor Authentication)**
    - Add extra security layer to IAM user
    - Required for production environments

3. **Use IAM Roles for Production**
    - EC2 instances should use IAM roles
    - Lambda functions should use execution roles
    - Avoid hardcoded credentials in production

4. **Monitor Access**
    - Review CloudTrail logs periodically
    - Set up billing alerts
    - Monitor for unusual activity

---

## Security Checklist

Before proceeding with development, verify:

- IAM user created with DynamoDB permissions
- Access keys generated and saved securely
- Credentials file created at `~/.aws/credentials`
- Credentials file has restricted permissions (`chmod 600`)
- `.gitignore` updated to exclude credentials
- Verified credentials work (using CLI or Java test)
- Access keys stored in password manager or secure location
- CSV file downloaded and stored securely (not in project directory)

---

## Troubleshooting

### "Unable to load credentials from any provider"

**Solutions:**
1. Verify `~/.aws/credentials` file exists
2. Check file permissions: `ls -l ~/.aws/credentials` (should be 600)
3. Verify credentials format (no extra spaces, proper section headers)
4. Try using environment variables instead

### "Access Denied" Errors

**Solutions:**
1. Verify IAM user has correct permissions
2. Check policy is attached to user or group
3. Wait 30-60 seconds after policy changes (propagation time)
4. Verify you're using the correct region

### AWS CLI Not Found

**Installation:**
- **macOS:** `brew install awscli`
- **Linux:** `sudo apt-get install awscli` or `sudo yum install aws-cli`
- **Windows:** Download from https://aws.amazon.com/cli/

---

## Additional Resources

- [AWS IAM Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/)
- [AWS SDK for Java 2.x Documentation](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/)
- [DynamoDB Best Practices](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/best-practices.html)
- [AWS Security Best Practices](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)

---

## Questions or Issues?

If you encounter problems during setup:
1. Check the troubleshooting section above
2. Verify all steps were completed in order
3. Review AWS CloudTrail logs for access attempts
4. Consult AWS documentation for specific error messages

---

# AWS Create DynamoDB Table

## Step 1: Log into AWS Console

1. Navigate to https://console.aws.amazon.com
2. Sign in with your AWS account credentials

## Step 2: Navigate to DynamoDB

1. In the AWS Console search bar (top), type **"DynamoDB"**
2. Click **"DynamoDB"**
3. You should see the DynamoDB Dashboard

## Step 3: Create DynamoDB table

Use AWS Console

1. In the left sidebar, click **"Tables"**
2. Click the **"Create table"** button (orange button, top right)
3. You should see the DynamoDB Dashboard

### Table Configuration

**Table name:** `noakweather-data` (or your preferred name)

**Partition key:** `station_id` (String)

**Sort key:** `observation_time` (Number)

**Billing:** On-demand

## Step 4: Review and Create

1. Review all user details:
    - Table name
    - Partition key
    - Sort key
    - Billing
2. Click **"Create table"**
3. Wait ~60 seconds for "Active" status

---

Or use AWS CLI:

```bash
aws dynamodb create-table \
    --table-name noakweather-data \
    --attribute-definitions \
        AttributeName=station_id,AttributeType=S \
        AttributeName=observation_time,AttributeType=N \
    --key-schema \
        AttributeName=station_id,KeyType=HASH \
        AttributeName=observation_time,KeyType=RANGE \
    --billing-mode PAY_PER_REQUEST \
    --region us-east-1
```

Test your new table using AWS CLI:

```bash
# Install AWS CLI if not already installed
# macOS: brew install awscli
# Linux: sudo apt-get install awscli
# Windows: download from AWS website

# List DynamoDB tables (should return empty list or existing tables)
aws dynamodb list-tables --region us-east-1
```

**Expected output:**
```json
{
    "TableNames": [
      "noakweather-data"
    ]
}
```
---

**Document Version:** 1.0  
**Last Updated:** January 21, 2026,  
**Project:** weather-platform (weather-storage module)
